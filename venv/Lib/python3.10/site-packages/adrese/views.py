from django.http import JsonResponse
from django.views import View
from django.db.models import Q
from .models import Localitate, Artera


class LocalitateAutocomplete(View):
    def get(self, request):
        query = request.GET.get("q", "").strip()

        if not query:
            return JsonResponse({"results": []})

        localitati = Localitate.objects.filter(denumire__icontains=query).values("id", "denumire")
        results = [{"id": loc["id"], "text": loc["denumire"]} for loc in localitati]

        return JsonResponse({"results": results})


class ArteraAutocomplete(View):
    def get(self, request):
        localitate_id = request.GET.get("localitate_id", "").strip()
        query = request.GET.get("q", "").strip()

        if not localitate_id:
            return JsonResponse({"results": []})

        artere = Artera.objects.filter(loc_cod_id=localitate_id, denumire__icontains=query).values("id", "denumire", "cod_postal")
        results = [{"id": art["id"], "text": art["denumire"], "cod_postal": art["cod_postal"]} for art in artere]

        return JsonResponse({"results": results})
